<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Dashboard | SCADA</title>
</head>
<body style="margin: 0; font-family: sans-serif; background: #f6f7fb;">

<div style="background: #fff; border-bottom: 1px solid #e5e7eb; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;">
    <div style="font-weight: 900; color: #047857; font-size: 1.2rem;">SECURE SCADA</div>
    <div style="display: flex; gap: 15px;">
        <a href="{% url 'patched_dashboard' %}" style="text-decoration: none; color: #047857; font-weight: 600; font-size: 0.9rem; padding: 5px 10px; background: rgba(16, 185, 129, 0.1); border-radius: 6px;">Dashboard</a>
        <a href="{% url 'patched_upload' %}" style="text-decoration: none; color: #4b5563; font-weight: 600; font-size: 0.9rem; padding: 5px 10px;">Secure Upload</a>
        <a href="{% url 'patched_deserialize' %}" style="text-decoration: none; color: #4b5563; font-weight: 600; font-size: 0.9rem; padding: 5px 10px;">Diagnostics (JSON)</a>
        <a href="{% url 'patched_ssrf' %}" style="text-decoration: none; color: #4b5563; font-weight: 600; font-size: 0.9rem; padding: 5px 10px;">Node Check</a>
        <a href="{% url 'patched_login' %}" style="text-decoration: none; color: #991b1b; font-weight: 700; font-size: 0.9rem; padding: 5px 10px; border: 1px solid #fee2e2; border-radius: 5px; background: #fef2f2;">Logout</a>
    </div>
</div>

<section class="scada-dash" aria-label="SCADA Secure Dashboard">
  <header class="dash-header">
    <div class="dash-title">
      <div class="title-row">
        <h2>SCADA Secure Dashboard</h2>
        <span class="badge badge-secure" title="Patched view">Secure</span>
      </div>

      <p class="sub">
        Welcome, <strong>{{ user.username }}</strong>
        <span class="meta">Admin: <strong>{{ user.is_admin }}</strong></span>
      </p>

      <p class="scenario">
        Patched: Only <strong>Operational</strong> devices are shown. Injection ignored.
      </p>
    </div>
  </header>

  <div class="table-card">
    <div class="table-head">
      <h3>Operational Devices</h3>
      <span class="pill">Total: {{ devices|length }}</span>
    </div>

    <div class="table-wrap" role="region" aria-label="Devices table" tabindex="0">
      <table class="scada-table">
        <thead>
          <tr>
            <th scope="col">Device Name</th>
            <th scope="col">IP Address</th>
            <th scope="col">Status</th>
          </tr>
        </thead>

        <tbody>
          {% for device in devices %}
          <tr>
            <td class="name">{{ device.name }}</td>
            <td class="mono">{{ device.ip_address }}</td>
            <td>
              <span class="status status-{{ device.status|lower|slugify }}">{{ device.status }}</span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="empty">No operational devices found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<style>
  :root{ --bg:#f6f7fb; --surface:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --shadow:0 18px 45px rgba(17,24,39,.10); --blue:#047857; --blue-600:#065f46; --ring:rgba(4, 120, 87, 0.22); --secure-bg:rgba(16, 185, 129, 0.1); --secure-bd:rgba(16, 185, 129, 0.2); --secure-tx:#065f46; --good-bg:rgba(16, 185, 129, 0.1); --good-bd:rgba(16, 185, 129, 0.2); --good-tx:#065f46; }
  
  body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); }
  * { box-sizing: border-box; }
  
  .scada-dash { padding: 22px 16px 30px; min-height: 80vh; }
  .dash-header { max-width: 1100px; margin: 0 auto 16px; }
  .dash-title h2 { margin:0; font-size:1.55rem; }
  .badge-secure { background: var(--secure-bg); border: 1px solid var(--secure-bd); color: var(--secure-tx); padding: 4px 8px; border-radius: 99px; font-size: 0.8rem; font-weight: 800; vertical-align: middle; margin-left: 10px; }
  .table-card { max-width: 1100px; margin: 0 auto; background: #fff; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); }
  .table-head { padding: 15px; background: #f9fafb; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .scada-table { width: 100%; border-collapse: separate; border-spacing: 0; }
  .scada-table th { background: #f9fafb; padding: 12px 14px; text-align: left; border-bottom: 1px solid var(--border); color: var(--muted); font-size: 0.85rem; text-transform: uppercase; }
  .scada-table td { padding: 12px 14px; border-bottom: 1px solid var(--border); }
  .status { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 99px; font-size: 0.85rem; font-weight: 700; background: var(--good-bg); color: var(--good-tx); }
  .mono { font-family: monospace; color: #374151; }
</style>
</body>
</html>